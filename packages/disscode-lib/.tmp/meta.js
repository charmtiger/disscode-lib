import AtAccordionMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-accordion/meta'
import AtActionSheetItemMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-action-sheet-item/meta'
import AtActionSheetMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-action-sheet/meta'
import AtActivityIndicatorMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-activity-indicator/meta'
import AtAvatarMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-avatar/meta'
import AtBadgeMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-badge/meta'
import AtButtonMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-button/meta'
import AtCardMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-card/meta'
import AtCheckboxMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-checkbox/meta'
import AtCountdownMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-countdown/meta'
import AtCurtainMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-curtain/meta'
import AtDividerMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-divider/meta'
import AtDrawerMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-drawer/meta'
import AtFabMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-fab/meta'
import AtFloatButtonMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-float-button/meta'
import AtFloatLayoutMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-float-layout/meta'
import AtFormMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-form/meta'
import AtGridMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-grid/meta'
import AtIconMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-icon/meta'
import AtImagePickerMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-image-picker/meta'
import AtIndexesMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-indexes/meta'
import AtInputNumberMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-input-number/meta'
import AtInputMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-input/meta'
import AtListItemMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-list-item/meta'
import AtListMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-list/meta'
import AtLoadMoreMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-load-more/meta'
import AtMessageMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-message/meta'
import AtModalMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-modal/meta'
import AtNavBarMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-nav-bar/meta'
import AtNoticebarMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-noticebar/meta'
import AtPaginationMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-pagination/meta'
import AtProgressMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-progress/meta'
import AtRadioMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-radio/meta'
import AtRangeMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-range/meta'
import AtRateMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-rate/meta'
import AtSearchBarMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-search-bar/meta'
import AtSegmentedControlMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-segmented-control/meta'
import AtSliderMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-slider/meta'
import AtStepsMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-steps/meta'
import AtSwipeActionMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-swipe-action/meta'
import AtSwitchMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-switch/meta'
import AtTabBarMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-tab-bar/meta'
import AtTabsPaneMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-tabs-pane/meta'
import AtTabsMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-tabs/meta'
import AtTagMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-tag/meta'
import AtTextareaMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-textarea/meta'
import AtTimelineMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-timeline/meta'
import AtToastMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/at-toast/meta'
import AutoListMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/auto-list/meta'
import ButtonMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/button/meta'
import ComponentMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/component/meta'
import DividerMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/divider/meta'
import EditorMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/editor/meta'
import FooterBarMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/footer-bar/meta'
import HeaderBarMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/header-bar/meta'
import ImageBackgroundMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/image-background/meta'
import ImageMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/image/meta'
import InputMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/input/meta'
import ModalMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/modal/meta'
import PageMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/page/meta'
import PickerMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/picker/meta'
import SafeViewMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/safe-view/meta'
import ScrollViewMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/scroll-view/meta'
import SwiperItemMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/swiper-item/meta'
import SwiperMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/swiper/meta'
import TabViewMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/tab-view/meta'
import TextMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/text/meta'
import TextareaMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/textarea/meta'
import ViewMeta from '/Users/huanglei/Documents/work/mengti/disscode-lib/packages/disscode-lib/lowcode/view/meta'

const componentCategorySort = {};
["基础元素","布局容器类","表格类","表单详情类","帮助类","对话框类","业务类","通用","引导","信息输入","信息展示","信息反馈"]
  .reverse()
  .forEach((item, index) => {
    componentCategorySort[item] = ++index;
  });

function generateComponentList(components) {
  const componentList = [
    {
      title: '常用',
      icon: '',
      children: [],
    },
    {
      title: '容器',
      icon: '',
      children: [],
    },
    {
      title: '导航',
      icon: '',
      children: [],
    },
    {
      title: '内容',
      icon: '',
      children: [],
    },
    {
      title: 'Feedback 反馈',
      icon: '',
      children: [],
    },
  ];

  const groupMap = {
    原子组件: true,
  };
  const compGroup = {};

  components.forEach((comp) => {
    const category = comp.category || '其他';
    if (comp.group && !compGroup[comp.componentName]) {
      compGroup[comp.componentName] = comp.group;
    }
    if (comp.group && !groupMap[comp.group]) {
      groupMap[comp.group] = true;
    }
    let target = componentList.find((item) => item.title === category);
    if (!target) {
      target = {
        title: category,
        icon: '',
        children: [],
      };

      componentList.push(target);
    }

    if (comp.snippets && comp.snippets.length) {
      target.children.push({
        componentName: comp.componentName,
        title: comp.title || comp.componentName,
        sort: {
          category: target.title,
          group: compGroup[comp.componentName] || '原子组件',
          priority: componentCategorySort[target.title] || 0,
        },
        icon: '',
        package: comp.npm.pkg,
        snippets: comp.snippets || [],
      });
    }
  });
  return componentList;
}

function fillRealVersion(meta, packageName = 'cross-ui', version = '0.0.4', basicLibraryVersion={"@alifd/next":"1.25.23","@alifd/meet":"2.6.3","antd":"4.17.3"}) {
  if (!meta || !version) {
    return meta;
  }
  const { npm } = meta;
  if (!npm) {
    return meta;
  }
  if (typeof basicLibraryVersion === 'object' && basicLibraryVersion[npm.package]) {
    meta.npm = {
      ...npm,
      version: basicLibraryVersion[npm.package]
    };
  } else if (npm.package === packageName) {
    meta.npm = {
      ...npm,
      version
    };
  }
  return meta;
}

const componentMetas = [AtAccordionMeta,AtActionSheetItemMeta,AtActionSheetMeta,AtActivityIndicatorMeta,AtAvatarMeta,AtBadgeMeta,AtButtonMeta,AtCardMeta,AtCheckboxMeta,AtCountdownMeta,AtCurtainMeta,AtDividerMeta,AtDrawerMeta,AtFabMeta,AtFloatButtonMeta,AtFloatLayoutMeta,AtFormMeta,AtGridMeta,AtIconMeta,AtImagePickerMeta,AtIndexesMeta,AtInputNumberMeta,AtInputMeta,AtListItemMeta,AtListMeta,AtLoadMoreMeta,AtMessageMeta,AtModalMeta,AtNavBarMeta,AtNoticebarMeta,AtPaginationMeta,AtProgressMeta,AtRadioMeta,AtRangeMeta,AtRateMeta,AtSearchBarMeta,AtSegmentedControlMeta,AtSliderMeta,AtStepsMeta,AtSwipeActionMeta,AtSwitchMeta,AtTabBarMeta,AtTabsPaneMeta,AtTabsMeta,AtTagMeta,AtTextareaMeta,AtTimelineMeta,AtToastMeta,AutoListMeta,ButtonMeta,ComponentMeta,DividerMeta,EditorMeta,FooterBarMeta,HeaderBarMeta,ImageBackgroundMeta,ImageMeta,InputMeta,ModalMeta,PageMeta,PickerMeta,SafeViewMeta,ScrollViewMeta,SwiperItemMeta,SwiperMeta,TabViewMeta,TextMeta,TextareaMeta,ViewMeta];
const components = [];
const npmInfo = {};
componentMetas.forEach(meta => {
  if (Array.isArray(meta)) {
    components.push(
      ...meta.map((item) => {
        if (!item.npm) {
          const { componentName } = item;
          const names = componentName.split('.');
          const [exportName, subName] = names;
          item.npm = {
            exportName: exportName,
            main: '',
            destructuring: true,
            subName: names.length > 1 ? componentName.slice(componentName.indexOf('.') + 1) : subName,
          };
        }
        item.npm = { ...npmInfo, ...(item.npm || {}) };
        return fillRealVersion(item);
      }),
    );
  } else if (meta.components) {
    components.push(
      ...meta.components.map((item) => {
        if (!item.npm) {
          const { componentName } = item;
          const names = componentName.split('.');
          const [exportName, subName] = names;
          item.npm = {
            exportName: exportName,
            main: '',
            destructuring: true,
            subName: names.length > 1 ? componentName.slice(componentName.indexOf('.') + 1) : subName,
          };
        }
        item.npm = { ...npmInfo, ...(item.npm || {}) };
        return fillRealVersion(item);
      }),
    );
  } else {
    if (!meta.npm) {
      const { componentName } = meta;
      const names = componentName.split('.');
      const [exportName, subName] = names;
      meta.npm = {
        exportName: exportName,
        main: '',
        destructuring: true,
        subName: names.length > 1 ? componentName.slice(componentName.indexOf('.') + 1) : subName,
      };
    }
    meta.npm = { ...npmInfo, ...(meta.npm || {}) };
    components.push(fillRealVersion(meta));
  }
});

const componentList = generateComponentList(components);

export { components, componentList };

const execCompile = !!false;

if (!execCompile) {
  window.CrossUiMeta = { components, componentList };
}